image: alpine/edge
packages:
  - curl
secrets:
  - 07d2d269-cf25-43e0-adbe-5f8b0da40583
sources:
  - https://git.sr.ht/~jordanreger/wx
tasks:
  - install-flyctl: |
      curl -L https://fly.io/install.sh | sh
  - deploy: |
      set +x
      export FLY_API_TOKEN=$(cat ~/.fly_token)
      set -x

      export FLYCTL_INSTALL="/home/build/.fly"
      export PATH="$FLYCTL_INSTALL/bin:$PATH"
      flyctl deploy --remote-only ./wx/bots
